var he=Object.create;var N=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,Ee=Object.prototype.hasOwnProperty;var Ie=(e,o)=>()=>(o||e((o={exports:{}}).exports,o),o.exports);var Se=(e,o,i,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let c of be(o))!Ee.call(e,c)&&c!==i&&N(e,c,{get:()=>o[c],enumerable:!(p=ve(o,c))||p.enumerable});return e};var ke=(e,o,i)=>(i=e!=null?he(we(e)):{},Se(o||!e||!e.__esModule?N(i,"default",{value:e,enumerable:!0}):i,e));var q=Ie((M,F)=>{(function(e,o){typeof M=="object"&&typeof F<"u"?F.exports=o():typeof define=="function"&&define.amd?define(o):(e=typeof globalThis<"u"?globalThis:e||self).ImageKit=o()})(M,(function(){"use strict";function e(t){return(e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(t)}function o(t,r){for(var a=0;a<r.length;a++){var n=r[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}function p(t,r){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),a.push.apply(a,n)}return a}function c(t){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?p(Object(a),!0).forEach((function(n){i(t,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))}))}return t}var I={message:"Missing urlEndpoint during SDK initialization",help:""},P={message:"Invalid transformationPosition parameter",help:""},G={message:"Missing file parameter for upload",help:""},X={message:"Missing fileName parameter for upload",help:""},Z={message:"Missing authentication endpoint for upload",help:""},_={message:"Missing public key for upload",help:""},Y={message:"The authenticationEndpoint you provided timed out in 60 seconds",help:""},Q={message:"Request to authenticationEndpoint failed due to network error",help:""},B={message:"Invalid response from authenticationEndpoint. The SDK expects a JSON response with three fields i.e. signature, token and expire.",help:""},ee={message:"Request to ImageKit upload endpoint failed due to network error",help:""},te={message:"Invalid uploadOptions parameter",help:""};function b(t,r,a){typeof a=="function"&&(t?a(r,null):a(null,r))}function re(t){var r={},a=t.getAllResponseHeaders();return Object.keys(a).length&&a.trim().split(/[\r\n]+/).map((function(n){return n.split(/: /)})).forEach((function(n){r[n[0].trim()]=n[1].trim()})),r}var C=function(t,r){var a=c({},t),n={statusCode:r.status,headers:re(r)};return Object.defineProperty(a,"$ResponseMetadata",{value:n,enumerable:!1,writable:!1}),a},ne=function(t){return new Promise((function(r,a){var n=new XMLHttpRequest;n.timeout=6e4;var s=new URL(t);s.searchParams.set("t",Math.random().toString()),n.open("GET",s.toString()),n.ontimeout=function(l){return a(Y)},n.onerror=function(){return a(Q)},n.onload=function(){if(n.status!==200)return a(B);try{var l=JSON.parse(n.responseText),d={signature:l.signature,expire:l.expire,token:l.token};return d.signature&&d.expire&&d.token?r(d):a(B)}catch{return a(B)}},n.send()}))},oe=function(t,r){return new Promise((function(a,n){t.open("POST","https://upload.imagekit.io/api/v1/files/upload"),t.onerror=function(s){return n(ee)},t.onload=function(){if(t.status===200)try{var s=JSON.parse(t.responseText),l=C(s,t);return a(l)}catch(m){return n(m)}else try{s=JSON.parse(t.responseText);var d=C(s,t);return n(d)}catch(m){return n(m)}},t.send(r)}))},ae=function(t,r,a,n){if(r.file)if(r.fileName)if(a.authenticationEndpoint)if(a.publicKey){var s,l=new FormData;for(s in r)s&&(s==="file"&&typeof r.file!="string"?l.append("file",r.file,String(r.fileName)):s==="tags"&&Array.isArray(r.tags)?l.append("tags",r.tags.join(",")):s==="responseFields"&&Array.isArray(r.responseFields)?l.append("responseFields",r.responseFields.join(",")):s==="extensions"&&Array.isArray(r.extensions)?l.append("extensions",JSON.stringify(r.extensions)):s!=="customMetadata"||e(r.customMetadata)!=="object"||Array.isArray(r.customMetadata)||r.customMetadata===null?r[s]!==void 0&&l.append(s,String(r[s])):l.append("customMetadata",JSON.stringify(r.customMetadata)));l.append("publicKey",a.publicKey),(function(d,m,v,S){ne(v.authenticationEndpoint).then((function(y){m.append("signature",y.signature),m.append("expire",String(y.expire)),m.append("token",y.token),oe(d,m).then((function(f){return b(!1,f,S)}),(function(f){return b(!0,f,S)}))}),(function(y){return b(!0,y,S)}))})(t,l,c(c({},a),{},{authenticationEndpoint:a.authenticationEndpoint}),n)}else b(!0,_,n);else b(!0,Z,n);else b(!0,X,n);else b(!0,G,n)},U={width:"w",height:"h",aspectRatio:"ar",quality:"q",crop:"c",cropMode:"cm",focus:"fo",x:"x",y:"y",format:"f",radius:"r",background:"bg",border:"b",rotation:"rt",rotate:"rt",blur:"bl",named:"n",overlayImage:"oi",overlayImageAspectRatio:"oiar",overlayImageBackground:"oibg",overlayImageBorder:"oib",overlayImageDPR:"oidpr",overlayImageQuality:"oiq",overlayImageCropping:"oic",overlayImageTrim:"oit",overlayX:"ox",overlayY:"oy",overlayFocus:"ofo",overlayHeight:"oh",overlayWidth:"ow",overlayText:"ot",overlayTextFontSize:"ots",overlayTextFontFamily:"otf",overlayTextColor:"otc",overlayTextTransparency:"oa",overlayAlpha:"oa",overlayTextTypography:"ott",overlayBackground:"obg",overlayTextEncoded:"ote",overlayTextWidth:"otw",overlayTextBackground:"otbg",overlayTextPadding:"otp",overlayTextInnerAlignment:"otia",overlayRadius:"or",progressive:"pr",lossless:"lo",trim:"t",metadata:"md",colorProfile:"cp",defaultImage:"di",dpr:"dpr",effectSharpen:"e-sharpen",effectUSM:"e-usm",effectContrast:"e-contrast",effectGray:"e-grayscale",original:"orig",raw:"raw"},ie=["path","query"],se=function(){return"path"},le=function(t){return t.transformationPosition==="query"},ue=function(t){return t.transformationPosition!==void 0&&ie.indexOf(t.transformationPosition)!=-1},ce=function(t){return t&&(U[t]||U[t.toLowerCase()])||""},D=function(){return":"},de=function(){return","},pe=function(){return"-"};function fe(t){return typeof t=="string"&&t[t.length-1]=="/"&&(t=t.substring(0,t.length-1)),t}function T(t,r){var a=r||"/",n=new RegExp(a+"{1,}","g");return t.join(a).replace(n,a)}var me=function(t){if(!t.path&&!t.src)return"";var r,a,n;try{t.path?(n=new URL(t.urlEndpoint).pathname,r=new URL(T([t.urlEndpoint.replace(n,""),t.path]))):(r=new URL(t.src),a=!0)}catch(d){return console.error(d),""}for(var s in t.queryParameters)r.searchParams.append(s,String(t.queryParameters[s]));var l=(function(d){if(!Array.isArray(d))return"";for(var m=[],v=0,S=d.length;v<S;v++){var y=[];for(var f in d[v]){var w=ce(f);if(w||(w=f),d[v][f]==="-")y.push(w);else if(f==="raw")y.push(d[v][f]);else{var k=d[v][f];w!=="oi"&&w!=="di"||(k=(k=fe((typeof(g=k||"")=="string"&&g[0]=="/"&&(g=g.slice(1)),g))).replace(/\//g,"@@")),y.push([w,k].join(pe()))}}m.push(y.join(de()))}var g;return m.join(D())})(t.transformation);return l&&l.length&&(le(t)||a?r.searchParams.append("tr",l):r.pathname=T(["tr"+D()+l,r.pathname])),r.pathname=T(n?[n,r.pathname]:[r.pathname]),r.href};return(function(){function t(s){if((function(l,d){if(!(l instanceof d))throw new TypeError("Cannot call a class as a function")})(this,t),i(this,"options",{sdkVersion:"javascript-".concat("1.5.4"),publicKey:"",urlEndpoint:"",transformationPosition:se()}),this.options=c(c({},this.options),s||{}),!this.options.urlEndpoint)throw I;if(!ue(this.options))throw P}var r,a,n;return r=t,(a=[{key:"url",value:function(s){return l=s,d=this.options,me(c(c({},d),l));var l,d}},{key:"upload",value:function(s,l,d){var m;if(typeof l=="function"?m=l:d=l||{},!s||e(s)!=="object")return b(!0,te,m);var v=c(c({},this.options),d),S=(s||{}).xhr;delete s.xhr;var y,f,w=S||new XMLHttpRequest;return(y=this,f=ae,function(){for(var k=arguments.length,g=new Array(k),L=0;L<k;L++)g[L]=arguments[L];if(g.length!==f.length||g[g.length-1]===void 0)return new Promise((function(ge,ye){g.pop(),g.push((function(K){if(K)return ye(K);for(var j=arguments.length,O=new Array(j>1?j-1:0),A=1;A<j;A++)O[A-1]=arguments[A];ge(O.length>1?O:O[0])})),f.call.apply(f,[y].concat(g))}));if(typeof g[g.length-1]!="function")throw new Error("Callback must be a function.");f.call.apply(f,[y].concat(g))})(w,s,v,m)}}])&&o(r.prototype,a),n&&o(r,n),t})()}))});var W=ke(q());import{initializeApp as xe}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";import{getDatabase as Pe,ref as $,push as Le,onValue as Oe,update as Ae,remove as Be}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";import{getAuth as Te,onAuthStateChanged as je,GoogleAuthProvider as Me,signInWithPopup as Fe,signInWithEmailAndPassword as $e,signOut as Re}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";var ze={apiKey:"AIzaSyD0xLuJlNiWr9-VvPOSxeYKXdfxzf1OZHM",authDomain:"do-to-list-aa1eb.firebaseapp.com",projectId:"do-to-list-aa1eb",storageBucket:"do-to-list-aa1eb.firebasestorage.app",messagingSenderId:"518478895264",appId:"1:518478895264:web:cbcba241dcd91c3ff651c5",databaseURL:"https://do-to-list-aa1eb-default-rtdb.firebaseio.com"},Ce={publicKey:"public_aF1VLWznWZonCwPUp2VzFSZFFjw=",urlEndpoint:"https://ik.imagekit.io/rkndkbsiy",authenticationEndpoint:"https://fleursdz.netlify.app/.netlify/functions/imagekit-auth"},V=xe(ze),R=Pe(V),H=$(R,"media"),E=Te(V),Ue=new Me,J;try{J=new W.default(Ce),console.log("ImageKit initialized successfully")}catch(e){throw console.error("Failed to initialize ImageKit:",e),alert("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0645\u0643\u062A\u0628\u0629 ImageKit. \u0627\u0644\u0631\u062C\u0627\u0621 \u0627\u0644\u062A\u062D\u0642\u0642 \u0645\u0646 \u0627\u0644\u0625\u0639\u062F\u0627\u062F\u0627\u062A."),e}var u={authSection:document.getElementById("authSection"),adminSection:document.getElementById("adminSection"),emailForm:document.getElementById("emailForm"),emailInput:document.getElementById("email"),passInput:document.getElementById("password"),googleBtn:document.getElementById("googleLoginBtn"),authMsg:document.getElementById("authMsg"),logoutBtn:document.getElementById("logoutBtn"),currentUserEl:document.getElementById("currentUser"),fileInput:document.getElementById("fileInput"),uploadBtn:document.getElementById("uploadBtn"),uploadList:document.getElementById("uploadList"),gallery:document.getElementById("gallery"),defaultAlt:document.getElementById("defaultAlt"),refreshBtn:document.getElementById("refreshBtn"),dropzone:document.getElementById("dropzone")},h={show:e=>e.style.display="",hide:e=>e.style.display="none",setAuthError:e=>{u.authMsg.textContent=e,u.authMsg.style.display=e?"block":"none"},isVideo:e=>e.type.startsWith("video/"),isImage:e=>e.type.startsWith("image/"),getFileName:e=>e.name.replace(/\.[^.]+$/,""),createProgressRow:e=>{let o=document.createElement("div");return o.className="border rounded p-2",o.innerHTML=`
            <div class="small mb-1">${e.name}</div>
            <div class="progress">
                <div class="progress-bar" style="width:0%"></div>
            </div>
            <div class="error text-danger mt-1" style="display:none;"></div>
        `,o}},z={loginWithGoogle:()=>{let e=location.hostname==="localhost"||location.hostname==="127.0.0.1";(e?signInWithRedirect:Fe)(E,Ue).then(i=>console.log("User signed in:",i.user)).catch(i=>{console.error(`${e?"Redirect":"Popup"} Error:`,i),h.setAuthError("\u0641\u0634\u0644 \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644 \u0628\u0627\u0633\u062A\u062E\u062F\u0627\u0645 \u062C\u0648\u062C\u0644.")})},handleAuthState:e=>{e?(h.hide(u.authSection),h.show(u.adminSection),u.currentUserEl.textContent=e.email||""):(h.show(u.authSection),h.hide(u.adminSection),u.currentUserEl.textContent="")},handleEmailLogin:async e=>{e.preventDefault();try{await $e(E,u.emailInput.value,u.passInput.value)}catch(o){console.error("Email login error:",o),h.setAuthError("\u0641\u0634\u0644 \u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644. \u062A\u0623\u0643\u062F \u0645\u0646 \u0627\u0644\u0628\u0631\u064A\u062F \u0648\u0643\u0644\u0645\u0629 \u0627\u0644\u0645\u0631\u0648\u0631.")}}},x={renderCard:(e,o)=>{let i=o.type==="video",p=i?`${o.url}#t=0.5`:`${o.url}?tr=w-400,h-400,fo-auto`,c=document.createElement("div");return c.className="card position-relative",c.innerHTML=`
            <span class="badge text-bg-${i?"dark":"info"} badge-type">${i?"\u0641\u064A\u062F\u064A\u0648":"\u0635\u0648\u0631\u0629"}</span>
            ${i?`<video class="w-100" src="${o.url}" preload="metadata" controls></video>`:`<img class="w-100 thumb" loading="lazy" src="${p}" alt="${o.alt||""}">`}
            <div class="p-2 d-flex gap-2 align-items-center">
                <input class="form-control form-control-sm" value="${o.alt||""}" placeholder="alt" data-key="${e}"/>
                <button class="btn btn-sm btn-outline-primary save" data-key="${e}">\u062D\u0641\u0638</button>
                <button class="btn btn-sm btn-outline-danger del" data-key="${e}" data-fileid="${o.fileId||""}">\u062D\u0630\u0641</button>
            </div>
        `,c},paintGallery:e=>{if(u.gallery.innerHTML="",!e)return;Object.entries(e).sort(([,i],[,p])=>(i.order||0)-(p.order||0)).forEach(([i,p])=>{u.gallery.appendChild(x.renderCard(i,p))})},uploadFile:async e=>{let o=h.createProgressRow(e),i=o.querySelector(".progress-bar"),p=o.querySelector(".error");u.uploadList.prepend(o);try{console.log("Attempting upload to ImageKit with file:",e.name);let c=await J.upload({file:e,fileName:e.name,useUniqueFileName:!0,tags:["fleursdz"],folder:"/fleursdz",progress:I=>{if(I&&I.loaded&&I.total){let P=Math.round(I.loaded/I.total*100);i.style.width=`${P}%`,console.log(`Upload progress for ${e.name}: ${P}%`)}}});console.log("Upload successful, result:",c),await Le(H,{url:c.url,fileId:c.fileId,type:h.isVideo(e)?"video":"image",alt:u.defaultAlt.value||h.getFileName(e),order:Date.now(),uid:E.currentUser.uid}),i.style.width="100%",p.style.display="none"}catch(c){throw console.error("Upload error for file",e.name,":",c),o.classList.add("border-danger"),p.textContent=`\u0641\u0634\u0644 \u0627\u0644\u0631\u0641\u0639: ${c.message}`,p.style.display="block",c}},handleSaveAlt:async e=>{if(!e.target.classList.contains("save")||!E.currentUser)return;let o=e.target.dataset.key,i=e.target.parentElement.querySelector("input");try{await Ae($(R,`media/${o}`),{alt:i.value}),e.target.classList.replace("btn-outline-primary","btn-success"),e.target.textContent="\u062A\u0645",setTimeout(()=>{e.target.classList.replace("btn-success","btn-outline-primary"),e.target.textContent="\u062D\u0641\u0638"},800)}catch(p){console.error("Save alt error:",p),alert("\u0641\u0634\u0644 \u062D\u0641\u0638 \u0627\u0644\u062A\u0639\u062F\u064A\u0644\u0627\u062A")}},handleDelete:async e=>{if(!e.target.classList.contains("del")||!E.currentUser)return;let o=e.target.dataset.key,i=e.target.dataset.fileid;if(confirm("\u062A\u0623\u0643\u064A\u062F \u0627\u0644\u062D\u0630\u0641\u061F"))try{if(i){let p=await fetch("/.netlify/functions/imagekit-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileId:i})});if(!p.ok)throw new Error(`Failed to delete file from ImageKit: ${p.statusText}`)}await Be($(R,`media/${o}`))}catch(p){console.error("Delete error:",p),alert("\u062A\u0639\u0630\u0631 \u0627\u0644\u062D\u0630\u0641: "+p.message)}}},De=()=>{u.googleBtn?.addEventListener("click",z.loginWithGoogle),u.emailForm?.addEventListener("submit",z.handleEmailLogin),u.logoutBtn?.addEventListener("click",()=>Re(E)),["dragenter","dragover"].forEach(e=>u.dropzone?.addEventListener(e,o=>{o.preventDefault(),u.dropzone.style.background="#eef"})),["dragleave","drop"].forEach(e=>u.dropzone?.addEventListener(e,o=>{o.preventDefault(),u.dropzone.style.background="#fff"})),u.dropzone?.addEventListener("drop",e=>{u.fileInput.files=e.dataTransfer.files}),u.uploadBtn?.addEventListener("click",async()=>{if(!E.currentUser)return alert("\u062A\u062D\u062A\u0627\u062C \u0644\u062A\u0633\u062C\u064A\u0644 \u0627\u0644\u062F\u062E\u0648\u0644");if(!u.fileInput.files.length)return alert("\u0627\u062E\u062A\u0631 \u0645\u0644\u0641\u0627\u062A \u0623\u0648\u0644\u0627\u064B");let e=Array.from(u.fileInput.files),o=25*1024*1024;for(let i of e){if(!h.isImage(i)&&!h.isVideo(i)){alert(`\u0646\u0648\u0639 \u0627\u0644\u0645\u0644\u0641 \u063A\u064A\u0631 \u0645\u062F\u0639\u0648\u0645: ${i.name}`);return}if(i.size>o){alert(`\u0627\u0644\u0645\u0644\u0641 ${i.name} \u064A\u062A\u062C\u0627\u0648\u0632 \u0627\u0644\u062D\u062F \u0627\u0644\u0623\u0642\u0635\u0649 25 \u0645\u064A\u062C\u0627\u0628\u0627\u064A\u062A`);return}}await Promise.all(e.map(i=>x.uploadFile(i))),u.fileInput.value=""}),u.gallery?.addEventListener("click",async e=>{e.target.classList.contains("save")?await x.handleSaveAlt(e):e.target.classList.contains("del")&&await x.handleDelete(e)}),u.refreshBtn?.addEventListener("click",()=>window.location.reload())};je(E,z.handleAuthState);Oe(H,e=>x.paintGallery(e.val()));De();
